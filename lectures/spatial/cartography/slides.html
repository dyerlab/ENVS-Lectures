<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Rasters</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs-2.6.6/header-attrs.js"></script>
    <link href="libs/remark-css-0.0.1/default.css" rel="stylesheet" />
    <link rel="stylesheet" href="../../css/slide_styles.css" type="text/css" />
    <link rel="stylesheet" href="../../css/slide_fonts.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">

class: left, middle, inverse
background-image: url("https://live.staticflickr.com/65535/50362989122_a8ee154fea_k_d.jpg")
background-size: cover





# .green[Cartography]

### .fancy[Continuously Distributed Data &lt;svg style="height:0.8em;top:.04em;position:relative;fill:limegreen;" viewBox="0 0 512 512"&gt;&lt;path d="M149.333 56v80c0 13.255-10.745 24-24 24H24c-13.255 0-24-10.745-24-24V56c0-13.255 10.745-24 24-24h101.333c13.255 0 24 10.745 24 24zm181.334 240v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm32-240v80c0 13.255 10.745 24 24 24H488c13.255 0 24-10.745 24-24V56c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24zm-32 80V56c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.256 0 24.001-10.745 24.001-24zm-205.334 56H24c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24zM0 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H24c-13.255 0-24 10.745-24 24zm386.667-56H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zm0 160H488c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H386.667c-13.255 0-24 10.745-24 24v80c0 13.255 10.745 24 24 24zM181.333 376v80c0 13.255 10.745 24 24 24h101.333c13.255 0 24-10.745 24-24v-80c0-13.255-10.745-24-24-24H205.333c-13.255 0-24 10.745-24 24z"/&gt;&lt;/svg&gt;]





---

# Rasters

.center[
.red[Rasters represent data distributed continuously across a spatial extent]
]

--
### Examples:

- Elevation (continuous)  
- Habitat Type (discrete)
- Precipitation (continuous)  
- Imperviable Surfaces (discrete)  




---

# What is the Structure of a Raster?

A Raster is simply a `matrix` of values with some additional decorations on it that allow it to have a spatial context.  


```r
values &lt;- rpois( n = 36, lambda=12)
values
```

```
##  [1] 14 14  9 10  7 11 18 11 14 23 11 14 14 12  7 12 17 10  8 10 13 13 11 20 13 13  7  5 14  9 11 12
## [33] 12 14 14  8
```

--


```r
x &lt;- matrix( values, nrow=6)
x
```

```
##      [,1] [,2] [,3] [,4] [,5] [,6]
## [1,]   14   18   14    8   13   11
## [2,]   14   11   12   10   13   12
## [3,]    9   14    7   13    7   12
## [4,]   10   23   12   13    5   14
## [5,]    7   11   17   11   14   14
## [6,]   11   14   10   20    9    8
```


---

# Spatial Designations

For each value in the `matrix`, when it is turned into a `raster` object: 

- The `cell` (pixel) has a defined spatial extent (width, height, &amp; origin).

- All the physical space represented by that cell has *exactly the same value*

- The *courseness* of the raster is question dependent:

  - 3x5 matrix for Continental US may not adequately capture elevation trends.
  
  - 1m&lt;sup&gt;2&lt;/sup&gt; matrix for elevation may be *a bit* too big.

---

# Matrix `\(\to\)` Raster


```r
library( raster )
r &lt;- raster( x )
r
```

```
## class      : RasterLayer 
## dimensions : 6, 6, 36  (nrow, ncol, ncell)
## resolution : 0.1666667, 0.1666667  (x, y)
## extent     : 0, 1, 0, 1  (xmin, xmax, ymin, ymax)
## crs        : NA 
## source     : memory
## names      : layer 
## values     : 5, 23  (min, max)
```

--

Notice that when I plot it out, it does not show the data, but a summary of the data along with some key data about the contents, including:  
- A class definition  
- The dimensions of the underlying data matrix,  
- The resolution (e.g., the spatial extent of the sides of each pixel).  Since we have no CRS here, it is equal to `\(nrows(x)^{-1}\)` and `\(ncols(x)^{-1}\)`.  
- The extent (the bounding box) and again since we do not have a CRS defined it just goes from `\(0\)` to `\(1\)`.
- The `crs` (missing)
- The source can be either `memory` if the raster is not that big or `out of memory` if it is just referencing.


---

# Loading A Raster

By far, you will most commonly working with pre-existing raster data.  

- Several file formats including GeoTIFF, BIL, &amp; ASC.
- All can be loaded from filesystem or internet with address.


```r
url &lt;- "https://github.com/dyerlab/ENVS-Lectures/raw/master/data/alt_22.tif"
r &lt;- raster( url )
r
```

```
## class      : RasterLayer 
## dimensions : 3600, 3600, 12960000  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -120, -90, 0, 30  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : https://github.com/dyerlab/ENVS-Lectures/raw/master/data/alt_22.tif 
## names      : alt_22 
## values     : -202, 5469  (min, max)
```

Notice that this raster has a defined CRS and as such it is projected and the extent relates to the units of the datum (e.g., from -120 to -90 degrees longitude and 0 to 30 degrees latitude).


---
class: sectionTitle, inverse

# .blue[Visualizing Rasters]

## .fancy[What good are they if we cannot look at them?]


---

# Built-in Plotting

Just like all things in `R`, `raster` objects can be visualized using built-in functions as well as functions from external libraries.

.pull-left[

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

```r
plot( r, 
      xlab="Longitude", 
      ylab="Latitude" )
```
]
.pull-right[
![](https://live.staticflickr.com/65535/50510331198_2a2c5bfe76_c_d.jpg)
]


---

# Raster Sizes

This particular raster is quite large (in terms of the number of cells)

.pull-left[

```
## class      : RasterLayer 
## dimensions : 3600, 3600, 12960000  (nrow, ncol, ncell)
## resolution : 0.008333333, 0.008333333  (x, y)
## extent     : -120, -90, 0, 30  (xmin, xmax, ymin, ymax)
## crs        : +proj=longlat +datum=WGS84 +no_defs 
## source     : https://github.com/dyerlab/ENVS-Lectures/raw/master/data/alt_22.tif 
## names      : alt_22 
## values     : -202, 5469  (min, max)
```
]

--

.pull-right[

These data only represent the elevation of the land.  Where there is water, the value in the underlying matrix is `NA`.  

Cell Type | Count 
----------|-------:
Land      | 2,469,350  
Water     | 10,490,650

]



---

# Cropping

One of the first things to do is to crop the data down to represent the size and extent of our study area.  If we over 10 million missing data points (the ocean) and most of Mexico in this raster above but we are only working with sites in Baja California (Norte y Sur), we would do well to excise (or crop) the raster to only include the area we are interested in working with.  

--

Workflow:  

1. Define a bounding box (the spatial extent of the region of interest)  
2. Expand it a bit so that points are not **on the edges** of the box.
3. Create an `extent`
4. Crop the original matrix to represent the boundaries defined in the `extent`


---

# Cropping 1: Bounding Box

Let's use the beetle data from the [Spatial Points Lecture](https://dyerlab.github.io/ENVS-Lectures/spatial/spatial_points/slides.html#1) as the data we will be working with.  


```r
library( sf )
library( tidyverse )
beetle_url &lt;- "https://raw.githubusercontent.com/dyerlab/ENVS-Lectures/master/data/Araptus_Disperal_Bias.csv"

read_csv( beetle_url ) %&gt;% 
  st_as_sf( coords=c("Longitude","Latitude"), crs=4326 ) -&gt; beetles

beetles %&gt;% 
  st_bbox()
```

```
##       xmin       ymin       xmax       ymax 
## -114.29353   23.28550 -109.32700   29.32541
```



---
class: sectionTitle, inverse

# .orange[Raster Manipulations]

## .fancy[Getting Data From the Map]





---

# Map Interactivity

You can work with raster data interactively (I just cannot do it here on this presentation because it has to be in real time).  


.pull-left[

```r
plot( alt )
click( alt, 
       xy=TRUE, 
       value=TRUE, 
       n=3 ) -&gt; points
```
]

.pull.right[
![](https://live.staticflickr.com/65535/50505505948_08e3e91dfb_w_d.jpg)
]













---

class: middle
background-image: url("images/contour.png")
background-position: right
background-size: auto

.center[

# Questions?


![Peter Sellers](https://live.staticflickr.com/65535/50382906427_2845eb1861_o_d.gif+)
]

&lt;p&gt;&amp;nbsp;&lt;/p&gt;

.bottom[ If you have any questions for about the content presented herein, please feel free to [submit them to me](mailto://rjdyer@vcu.edu) and I'll get back to you as soon as possible.]


    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "default",
"highlightLines": true,
"ratio": "16:9",
"countIncrementalSlides": false
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
